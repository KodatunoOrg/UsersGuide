<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"> 
<HTML> 
<HEAD LANG="ja"> 
	<TITLE>Kodatuno User's Guide</TITLE> 
	<meta HTTP-EQUIV="Content-type" CONTENT="text/html; charset=euc-jp"> 
</HEAD> 
<BODY bgcolor="#ffffff"> 
<table cellspacing="0" cellpadding="0" border="0" width="100%">   
	<tr valign="top" height="32">   
	</tr>   
	<tr valign="top">        
		<td width="256" valign="bottom" align="left">          
			<IMG SRC="pixmaps/logo.jpg" width="300" height="98" alt="Kodatuno Logo" ALIGN="top">
		</td>        
		<td valign="bottom" align="center">          
			<center> 	   
		<b><big>Kodatuno User's Guide</big>
		</b>
		<center>        
		</td>       
		<td width="20%" valign="bottom" align="right">     
			<A HREF="./2-6.html">Prev</A>     
			<A HREF="./index.html">Index</A>
			<A HREF="./2-8.html">Next</A><br>
		</td>   
	</tr> 
</table> 
<blockquote> 

<BR><HR><H2>簡単なアプリケーションの作成</H2>

このセクションでは、サンプルアプリケーションの応用として、1つのNURBS曲面をz方向にr倍し,y軸周りにdeg度回転させ、z方向にhだけシフトさせて
新たなNURBS曲面を作成し、これら2つのNURBS曲面の交線を算出してみます。<BR><BR>

<OL>
<BR><LI>まず、UserFunc.cpp内のCalcIntersecPts()関数を以下のように変更します。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CalcIntersecPts2.jpg"></CENTER></P>
</CENTER></P>

<BR><LI>次に、UserFuncSub.hにExecSampleFunc4()をプロトタイプ宣言します。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFuncSub_H2.jpg"></CENTER></P>
</CENTER></P>

<BR><LI>次に、UserFuncSub.cppにExecSampleFunc4の実体を記述します。これは、ExeSampleFunc1()を丸ごとコピーし、ContourLine()のみ
異なる関数とすればよいでしょう。今回はCrossLine()という関数名にします。引数は、
<UL>
<BR><LI>*NurbsS:　読み込んだNURBS曲面へのポインタ
<BR><LI>r:　NURBS曲面の倍率(prop[0])
<BR><LI>deg:　NURBS曲面の回転量(prop[1])
<BR><LI>h:　r倍されたNURBS曲面のシフト量(prop[2])
<BR><LI>ds:　交点群各点間の距離(prop[3])<BR><BR>
</UL>
とします。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_ExecSampleFunc4.jpg"></CENTER></P>
</CENTER></P>
また同時に、UserFuncSub.hにCrossLine()のプロトタイプ宣言を付加しておいてください。<BR><BR>

<BR><LI>CrossLine()の実体を書いていきます。
まず、NURBS演算関数を用いるため、NURBS_Funcクラスのオブジェクトを生成します。次に、NURBS_FuncのChRatioNurbsS()関数、RotNurbsS()関数、
ShiftNurbsSurfe()関数を用いて、指定したNURBS曲面をz方向にr倍し、y軸周りにdeg度回転させ、z方向にdシフトさせます。
このとき、変更されたNURBS曲面はオリジナルのNURBS曲面とは異なる新たなNURBS曲面として定義しなおす必要があります。これは、NURBS_FuncのGenNurbsS()関数を用います。
ここまでで、実際にr倍されたNURBS曲面が生成されたか、グラフィックに描画して確かめてみましょう。
このとき、NURBS描画関数を使うために、Describe_BODYクラスのオブジェクトを生成しなければなりません。NURBS曲面描画関数はDrawNurbsSurfe()です。<BR>
ここまでのプログラムを以下に示します。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CrossLine1.jpg"></CENTER></P>
</CENTER></P>

このプログラムを実行してみましょう。これまでのプログラムの変更を全て保存し、<A HREF="2-2.html">2.2  Kodatunoを動かしてみよう </A>に沿って
コンパイル、実行してください。次に、"FreeSurf.IGS"を読み込み、選択状態にします。"User Stat"を開き、Modeを4にセット、Prop1〜3までに適当な値を入れ、
"CalcIntersecLine"ボタンを押します。下図は、Prop1=2, Prop2=30, Prop3=10とした場合の結果です。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CrossLine1_Result.jpg"></CENTER></P>
</CENTER></P>

ここで、新たに作成したNURBS曲面は、新たなBodyとして登録されているわけではないことに注意してください。新たに登録する場合は、
BODY_HandlerクラスのRegistNurbsStoBody()関数を用います。このとき、この関数の引数として、登録するBODYListへのポインタと新たなBODYが必要になります。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CrossLine2.jpg"></CENTER></P>
</CENTER></P>

<BR><LI>ここでは、新たなBodyとして登録しないで進めます。<BR>
次に、NURBS曲面同士の交点群を算出するために、NFunc.CalcIntersecPtsNurbsSSearch()関数を用います。さらに、これによって得られた交点群から、NURBS曲線を生成
してみます。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CrossLine3.jpg"></CENTER></P>
</CENTER></P>

赤枠部を付加することにより、交点群が算出され、描画されます。また、青枠部を付加すれば、得られた交点群からNURBS曲線を生成します。
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CrossLine2_Result.jpg"></CENTER></P>
［交点群］
</CENTER></P>
<P><CENTER>
<P><CENTER><IMG SRC="pixmaps/UserFunc_CrossLine3_Result.jpg"></CENTER></P>
［交線］
</CENTER></P>

交線の表示が部分的におかしいのは、交点配列がきれいにソートされていないからです。CalcIntersecPtsNurbsSSearch()関数などを用いて交点群を生成する場合は、
かならずしも、順序正しく点が格納されていないため、何らかのソート用コードを記述しなければなりません。<BR><BR>
</OL>

以上で、簡単なアプリケーション作成手順の説明を終わります。

</blockquote> <HR> Document Release 1.0 for Kodatuno R1.1, Mar. 2011<P> <hr> <center>
<A HREF="./2-6.html">Prev</A>
<A HREF="./index.html">index</A>
<A HREF="./2-8.html">Next</A><br>
</center> <hr> <table cellpadding="0" cellspacing="0" border="0" width="100%">    
<tr>      
	<td align="left">        
		<small>Copyright(C) Kodatuno Development Team, 2011</small>      
	</td>      
	<td align="right">        
		<small><i>Last modified: Mar. 3, 2011</i></small>      
	</td>   
</tr> </table>  <!-- end of body --> </body>  
</html>  

